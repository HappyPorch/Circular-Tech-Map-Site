{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://circulartechmap.com/schema/enabler.json",
  "title": "Circular Economy Digital Enabler",
  "description": "Schema for digital software enablers for circularity in the Circular Economy Tech Map",
  "type": "object",
  "required": ["uid", "meta", "name", "url", "description", "logo", "profile", "circularCategorisation"],
  "properties": {
    "uid": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier (GUID)"
    },
    "meta": {
      "type": "object",
      "required": ["dateAdded"],
      "properties": {
        "dateAdded": {
          "type": "string",
          "format": "date-time",
          "description": "Date added in ISO 8601 format"
        },
        "dateLastCheckedAgent": {
          "anyOf": [
            {
              "type": "string",
              "format": "date-time"
            },
            {
              "type": "null"
            }
          ],
          "description": "Date last checked by agent in ISO 8601 format"
        },
        "dateLastHumanVerified": {
          "anyOf": [
            {
              "type": "string",
              "format": "date-time"
            },
            {
              "type": "null"
            }
          ],
          "description": "Date last verified by human in ISO 8601 format"
        },
        "techMapRelevance": {
          "type": "object",
          "required": ["value", "confidence", "notes"],
          "properties": {
            "value": {
              "type": "boolean",
              "description": "Indicates whether the enabler meets criteria for inclusion in the Circular Tech Map"
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of tech map relevance assessment"
            }
          }
        }
      }
    },
    "name": {
      "type": "string",
      "minLength": 3,
      "description": "Name of the digital enabler"
    },
    "url": {
      "type": "string",
      "format": "uri",
      "description": "Primary website URL"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the enabler for display on web"
    },
    "logo": {
      "type": "string",
      "description": "Logo filename"
    },
    "profile": {
      "type": "object",
      "required": ["hq", "sector", "active", "geographicalReach", "organisationalType"],
      "properties": {
        "hq": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "3-letter country code for primary headquarters"
        },
        "sector": {
          "type": "object",
          "required": ["values", "confidence", "notes"],
          "properties": {
            "values": {
              "type": "array",
              "maxItems": 2,
              "minItems": 1,
              "items": {
                "type": "string",
                "enum": [
                  "All / Any", "Agriculture & Food", "Automotive & Transport", "Construction & Built Environment",
                  "Fashion & Textiles", "Electronics & IT Hardware", "Healthcare & Pharmaceuticals", "Retail & Consumer Goods",
                  "Waste Management & Recycling", "Grants, Funding & Policy", "Industrial & Manufacturing", "Energy & Utilities",
                  "Chemicals & Materials"
                ]
              }
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of categorization"
            }
          }
        },
        "active": {
          "type": "object",
          "required": ["value", "confidence", "notes"],
          "properties": {
            "value": {
              "type": "boolean",
              "description": "False only if there is explicit evidence of closure, retirement, or pivot away from circularity"
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of active status assessment"
            }
          }
        },
        "geographicalReach": {
          "type": "object",
          "required": ["value", "confidence", "notes"],
          "properties": {
            "value": {
              "type": "string",
              "enum": ["Local", "Regional", "National", "International", "Global"]
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of geographical reach"
            }
          }
        },
        "organisationalType": {
          "type": "object",
          "required": ["value", "confidence", "notes"],
          "properties": {
            "value": {
              "type": "string",
              "enum": ["ForProfit", "NonProfit", "Cooperative", "PublicSector", "Unknown"]
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation including B Corp or other certifications where relevant"
            }
          }
        }
      }
    },
    "circularCategorisation": {
      "type": "object",
      "required": ["circularityRelevance", "hardwareComponent", "rStrategy", "circularBusinessModel", "role", "type"],
      "properties": {
        "circularityRelevance": {
          "type": "object",
          "required": ["value", "confidence", "notes"],
          "properties": {
            "value": {
              "type": "string",
              "enum": ["Core", "Supporting", "Tangential"]
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of relevance assessment"
            }
          }
        },
        "hardwareComponent": {
          "type": "object",
          "required": ["value", "confidence", "notes"],
          "properties": {
            "value": {
              "type": "boolean",
              "description": "True if the enabler includes a hardware component"
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of hardware component assessment"
            }
          }
        },
        "hardwareType": {
          "type": "array",
          "maxItems": 2,
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": ["IoT_Sensors", "Robotics", "Smart_Devices", "Industrial_Systems", "Other"]
          },
          "description": "Hardware type classification (max 2). Required if hardwareComponent value is true."
        },
        "hardwareRole": {
          "type": "array",
          "maxItems": 2,
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": ["Data_Collection", "Physical_Processing", "User_Interface", "Asset_Tracking"]
          },
          "description": "Role of hardware component (max 2). Required if hardwareComponent value is true."
        },
        "rStrategy": {
          "type": "object",
          "required": ["primary", "confidence", "notes"],
          "properties": {
            "primary": {
              "type": "array",
              "maxItems": 2,
              "minItems": 1,
              "items": {
                "type": "string",
                "enum": ["R0", "R1", "R2", "R3", "R4", "R5", "R6", "R7", "R8"]
              }
            },
            "secondary": {
              "type": "array",
              "maxItems": 3,
              "minItems": 0,
              "items": {
                "type": "string",
                "enum": ["R0", "R1", "R2", "R3", "R4", "R5", "R6", "R7", "R8"]
              }
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of R Strategy categorization"
            }
          }
        },
        "circularBusinessModel": {
          "type": "object",
          "required": ["values", "confidence", "notes"],
          "properties": {
            "values": {
              "type": "array",
              "maxItems": 2,
              "minItems": 1,
              "items": {
                "type": "string",
                "enum": [
                  "Product-as-a-Service (PaaS)", "Rental / Leasing", "Sharing / Collaborative Use", "Repair",
                  "Refurbishment & Remanufacturing", "Resale / Second-hand", "Recycling / Resource Recovery",
                  "Upcycling", "Refill & Reuse", "Industrial Symbiosis / By-product Exchange", "Take-back / Buy-back",
                  "Circular Logistics"
                ]
              }
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of business model categorization"
            }
          }
        },
        "role": {
          "type": "object",
          "required": ["values", "confidence", "notes"],
          "properties": {
            "values": {
              "type": "array",
              "maxItems": 2,
              "minItems": 1,
              "items": {
                "type": "string",
                "enum": ["DirectEnabler", "SupportEnabler"]
              }
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of role categorization"
            }
          }
        },
        "type": {
          "type": "object",
          "required": ["category", "confidence", "notes"],
          "properties": {
            "category": {
              "type": "string",
              "enum": [
                "Marketplace", "CircularRetailer", "Informational", "Design & Lifecycle",
                "Traceability", "Standardisation", "Circular Logistics"
              ]
            },
            "subType": {
              "type": "string",
              "description": "Required for Informational, Design & Lifecycle, Traceability, Standardisation, and Circular Logistics categories"
            },
            "valueObject": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string",
                "enum": ["Products", "Materials", "Services", "Intangible"]
              },
              "description": "Required for Marketplace and CircularRetailer types"
            },
            "matchmakingType": {
              "type": "array",
              "maxItems": 2,
              "minItems": 1,
              "items": {
                "type": "string",
                "enum": ["C2C", "B2C", "B2B", "B2G", "B2B2C", "C2B"]
              },
              "description": "Required for Marketplace and CircularRetailer types"
            },
            "confidence": { "$ref": "#/definitions/confidence" },
            "notes": {
              "type": "string",
              "description": "Markdown-formatted explanation of type categorization including sub-type details"
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "hardwareComponent": {
                "properties": {
                  "value": { "const": true }
                }
              }
            }
          },
          "then": {
            "required": ["circularityRelevance", "hardwareComponent", "hardwareType", "hardwareRole", "rStrategy", "circularBusinessModel", "role", "type"]
          }
        },
        {
          "if": {
            "properties": { 
              "type": {
                "properties": {
                  "category": { "enum": ["Marketplace", "CircularRetailer"] }
                }
              }
            }
          },
          "then": {
            "properties": {
              "type": {
                "required": ["category", "valueObject", "matchmakingType", "confidence", "notes"]
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "properties": {
                  "category": {
                    "enum": ["Informational", "Design & Lifecycle", "Traceability", "Standardisation", "Circular Logistics"]
                  }
                }
              }
            }
          },
          "then": {
            "properties": {
              "type": {
                "required": ["category", "subType", "confidence", "notes"],
                "properties": {
                  "subType": {
                    "anyOf": [
                      {
                        "if": { 
                          "properties": { "category": { "const": "Informational" } }
                        },
                        "then": {
                          "enum": ["Knowledge Hub", "Training", "Data Resources"]
                        }
                      },
                      {
                        "if": { 
                          "properties": { "category": { "const": "Design & Lifecycle" } }
                        },
                        "then": {
                          "enum": [
                            "Circular Design Tools", "Lifecycle Assessment (LCA) & Modelling Tools",
                            "Digital Twins & Simulation Platforms", "Product Lifecycle Management (PLM)"
                          ]
                        }
                      },
                      {
                        "if": { 
                          "properties": { "category": { "const": "Traceability" } }
                        },
                        "then": {
                          "enum": ["Inventory", "Tracking", "Digital Product Passports (DPPs)"]
                        }
                      },
                      {
                        "if": { 
                          "properties": { "category": { "const": "Standardisation" } }
                        },
                        "then": {
                          "enum": ["Standards", "Ontologies"]
                        }
                      },
                      {
                        "if": { 
                          "properties": { "category": { "const": "Circular Logistics" } }
                        },
                        "then": {
                          "enum": ["Reverse Logistics", "Take-back & Collection", "Reuse & Refill Logistics", "Pooling & Asset Sharing Logistics"]
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      ]
    }
  },
  "definitions": {
    "confidence": {
      "type": "string",
      "enum": ["High", "Medium", "Low"],
      "description": "High: Explicitly stated in company materials, validated by multiple sources; Medium: Clearly inferred from service descriptions or case studies; Low: Interpreted from limited information or indirect evidence"
    }
  }
}